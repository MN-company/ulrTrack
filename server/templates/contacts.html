{% extends "base.html" %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <h2><i class="fas fa-address-book"></i> Contacts / Leads</h2>
    <div class="flex-row" style="gap: 10px;">
        <a href="/dashboard/merge_candidates" class="btn-outline btn-sm"><i class="fas fa-code-branch"></i> Merge
            Identities</a>
        <a href="/dashboard/contacts/export_csv" class="btn-outline btn-sm"><i class="fas fa-file-csv"></i> Export
            CSV</a>
        <a href="/dashboard" class="btn-outline btn-sm">Back</a>
    </div>
</div>

<div class="card">
    <h3><i class="fas fa-plus"></i> Add Manual Target</h3>
    <form method="POST" class="flex-row" style="align-items: flex-end; gap:10px;">
        <div style="flex:1">
            <label style="font-size:0.8rem; color:var(--text-sec);">Email</label>
            <input type="email" name="email" placeholder="target@example.com" required>
        </div>
        <div style="flex:1">
            <label style="font-size:0.8rem; color:var(--text-sec);">Name / Alias</label>
            <input type="text" name="name" placeholder="John Doe">
        </div>
        <button type="submit" class="btn">ADD</button>
    </form>
</div>

<div class="card">
    <p style="color:var(--text-sec); margin-bottom:20px;">
        Database of collected and manual targets.
    </p>

    <table>
        <thead>
            <tr>
                <th>Identity</th>
                <th>Added</th>
                <th>Socials Found</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for lead in leads %}
            <tr>
                <td>
                    <div style="font-weight: 600; font-size: 1.1rem; color: white;">
                        <a href="/dashboard/lead/{{ lead.id }}" class="text-accent">{{ lead.email }}</a>
                    </div>
                    {% if lead.name %}
                    <div style="font-size:0.8rem; color:var(--text-sec);">{{ lead.name }}</div>
                    {% endif %}
                    {% if lead.tags %}
                    <div style="margin-top:4px;">
                        {% for tag in lead.tags.split(',') %}
                        <span class="badge badge-gray" style="font-size:0.7rem; padding:2px 6px;">{{ tag.strip()
                            }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </td>
                <td class="mono" style="color:var(--text-sec);">
                    {{ lead.created_at.strftime('%Y-%m-%d') }}
                </td>
                <td>
                    {% if lead.holehe_data %}
                    <span class="badge badge-green">YES</span>
                    {% else %}
                    <span class="badge badge-gray">NO</span>
                    {% endif %}
                </td>
                <td>
                    <a href="/dashboard/lead/{{ lead.id }}" class="btn-outline btn-sm">
                        <i class="fas fa-id-card"></i> PROFILE
                    </a>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="4" style="text-align:center; padding:30px; color:var(--text-sec);">
                    No leads yet.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}