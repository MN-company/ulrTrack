{% extends "base.html" %}

{% block head %}
<style>
    .tab-nav {
        display: flex;
        gap: 8px;
        margin-bottom: 24px;
        border-bottom: 1px solid var(--border-subtle);
        padding-bottom: 12px;
        flex-wrap: wrap;
    }

    .tab-btn {
        background: none;
        border: none;
        color: var(--text-muted);
        padding: 10px 18px;
        cursor: pointer;
        font-size: 0.95rem;
        border-radius: 8px;
        transition: all 0.2s ease;
    }

    .tab-btn:hover {
        background: rgba(255, 255, 255, 0.05);
        color: var(--text-primary);
    }

    .tab-btn.active {
        background: var(--accent-primary);
        color: #000;
        font-weight: 600;
    }

    .tab-content {
        display: none;
        animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .tab-content.active {
        display: block;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        color: var(--text-secondary);
        margin-bottom: 8px;
        font-size: 0.9rem;
        font-weight: 500;
    }

    .form-group input,
    .form-group select {
        width: 100%;
        background: var(--bg-input);
        border: 1px solid var(--border-subtle);
        color: var(--text-primary);
        padding: 12px 14px;
        border-radius: 8px;
        font-size: 0.95rem;
        transition: border-color 0.2s ease;
    }

    .form-group input:focus,
    .form-group select:focus {
        outline: none;
        border-color: var(--accent-primary);
    }

    .form-group input::placeholder {
        color: var(--text-muted);
    }

    .toggle-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 14px 16px;
        background: var(--bg-input);
        border: 1px solid var(--border-subtle);
        border-radius: 10px;
        margin-bottom: 12px;
    }

    .toggle-row label {
        margin: 0;
        color: var(--text-primary);
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .toggle-row input[type="checkbox"] {
        width: 20px;
        height: 20px;
        accent-color: var(--accent-primary);
        cursor: pointer;
    }

    .toggle-row input[type="text"] {
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid var(--border-subtle);
        color: var(--text-primary);
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 0.85rem;
    }

    .section-title {
        font-size: 0.8rem;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 16px;
        margin-top: 24px;
        padding-bottom: 8px;
        border-bottom: 1px solid var(--border-subtle);
    }
</style>
<script>
    function openTab(name) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(name).classList.add('active');
        document.getElementById('btn-' + name).classList.add('active');
    }
</script>
{% endblock %}

{% block content %}
<div class="card" style="max-width: 800px; margin: 0 auto;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h2>Create New Link</h2>
        <a href="/dashboard" class="btn-outline btn-sm">Cancel</a>
    </div>

    <form method="POST">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <div class="tab-nav">
            <button type="button" id="btn-general" class="tab-btn active" onclick="openTab('general')">General</button>
            <button type="button" id="btn-targeting" class="tab-btn" onclick="openTab('targeting')">Targeting</button>
            <button type="button" id="btn-protection" class="tab-btn"
                onclick="openTab('protection')">Protection</button>
            <button type="button" id="btn-scheduling" class="tab-btn"
                onclick="openTab('scheduling')">Scheduling</button>
            <button type="button" id="btn-limits" class="tab-btn" onclick="openTab('limits')">Limits</button>
        </div>

        <div id="general" class="tab-content active">
            <div class="form-group">
                <label>Destination URL *</label>
                <input type="url" name="destination" placeholder="https://..." required>
            </div>
            <div class="form-group">
                <label>Slug (Leave empty for random)</label>
                <input type="text" name="slug" placeholder="e.g. secret-sale">
            </div>

            <div class="toggle-row" style="margin-top: 10px;">
                <label>Mask Link (Hide Server URL via is.gd)</label>
                <input type="checkbox" name="mask_link" value="true" style="width:auto;">
            </div>
        </div>

        <!-- V14: Limits Tab (New) -->
        <div id="limits" class="tab-content">
            <div class="form-group">
                <label>Max Clicks (0 = Unlimited)</label>
                <input type="number" name="max_clicks" value="0">
            </div>
            <div class="form-group">
                <label>Expiration (Minutes, 0 = Forever)</label>
                <input type="number" name="expiration_minutes" value="0">
            </div>
        </div>

        <div id="targeting" class="tab-content">
            <div class="form-group">
                <label><i class="fab fa-apple"></i> iOS Destination</label>
                <input type="url" name="ios_url" placeholder="https://apps.apple.com/...">
            </div>
            <div class="form-group">
                <label><i class="fab fa-android"></i> Android Destination</label>
                <input type="url" name="android_url" placeholder="https://play.google.com/...">
            </div>
        </div>

        <div id="protection" class="tab-content">
            <div class="toggle-row">
                <label>Block Bots & Crawlers</label>
                <input type="checkbox" name="block_bots" value="true" checked style="width:auto;">
            </div>
            <div class="toggle-row">
                <label>Block VPN / Proxies</label>
                <input type="checkbox" name="block_vpn" value="true" style="width:auto;">
            </div>
            <div class="toggle-row">
                <label>Block AdBlock Users (Redirect to Safe)</label>
                <input type="checkbox" name="block_adblock" value="true" style="width:auto;">
            </div>

            <div class="toggle-row" style="margin-top:20px;">
                <label>Enable Captcha (Turnstile)</label>
                <input type="checkbox" name="enable_captcha" value="true" style="width:auto;">
            </div>

            <div class="toggle-row">
                <label>Require Valid Email (Email Gate)</label>
                <input type="checkbox" name="require_email" value="true" style="width:auto;">
            </div>

            <div class="form-group" style="margin-top: 10px;">
                <label>Email Policy</label>
                <select name="email_policy">
                    <option value="all">Allow All Emails</option>
                    <option value="certified">Certified Only (Block Temp)</option>
                    <option value="trackable">Trackable Only (Corp/ISP)</option>
                </select>
            </div>

            <div class="toggle-row">
                <label>Allowed Countries Only (e.g. IT,US)</label>
                <input type="text" name="allowed_countries" placeholder="Comma separated codes (empty = all)"
                    style="width: 200px;">
            </div>

            <div class="form-group" style="margin-top: 20px;">
                <label>Safe URL (Cloaking Destination)</label>
                <input type="url" name="safe_url" placeholder="https://google.com">
            </div>

            <div class="form-group">
                <label>Password Protection</label>
                <input type="text" name="password" placeholder="Leave empty to disable">
            </div>
        </div>

        <div id="scheduling" class="tab-content">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="form-group">
                    <label>Start Active Hour (0-23)</label>
                    <input type="number" name="schedule_start_hour" min="0" max="23">
                </div>
                <div class="form-group">
                    <label>End Active Hour (0-23)</label>
                    <input type="number" name="schedule_end_hour" min="0" max="23">
                </div>
            </div>
            <div class="form-group">
                <label>Timezone</label>
                <input type="text" name="schedule_timezone" value="UTC">
            </div>
        </div>

        <div style="margin-top: 30px; border-top: var(--border); padding-top: 20px; text-align: right;">
            <button type="submit" class="btn">CREATE LINK</button>
        </div>
    </form>
</div>
{% endblock %}