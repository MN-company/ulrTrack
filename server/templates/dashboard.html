{% extends "base.html" %}

{% block head %}
<style>
    /* Dashboard specific styles */
    .quick-create {
        display: grid;
        grid-template-columns: 3fr 1fr 1fr 1fr auto;
        gap: 10px;
        align-items: center;
    }

    .metrics {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
        margin-bottom: 30px;
    }

    .metric-card {
        background: linear-gradient(145deg, rgba(255, 255, 255, 0.03) 0%, rgba(255, 255, 255, 0.01) 100%);
        padding: 20px;
        border-radius: 12px;
        border: var(--border);
    }

    .metric-val {
        font-size: 2rem;
        font-weight: 700;
        color: white;
    }

    .metric-label {
        font-size: 0.8rem;
        color: var(--text-sec);
        text-transform: uppercase;
        letter-spacing: 1px;
    }
</style>
{% endblock %}

{% block content %}

<!-- Metrics Row -->
<div class="metrics">
    <div class="metric-card">
        <div class="metric-val mono"><i class="fas fa-link"></i> {{ total_links }}</div>
        <div class="metric-label">Active Links</div>
    </div>
    <div class="metric-card">
        <div class="metric-val mono"><i class="fas fa-mouse-pointer"></i> {{ total_clicks }}</div>
        <div class="metric-label">Total Visits</div>
    </div>
    <div class="metric-card">
        <div class="metric-val mono"><i class="fas fa-shield-alt"></i> {{ total_blocked }}</div>
        <div class="metric-label">Blocked</div>
    </div>
    <div class="metric-card">
        <div class="metric-val mono text-accent"><i class="fas fa-chart-line"></i> {{ (total_clicks - total_blocked) }}
        </div>
        <div class="metric-label">Successful</div>
    </div>
</div>

<!-- Quick Create Bar -->
<div class="card">
    <form method="POST" action="/dashboard/create" class="quick-create">

        {{ csrf_token() }}
        <input type="url" name="destination" placeholder="Paste Target URL here..." required>

        <input type="text" name="slug" placeholder="Slug (Opt)">

        <!-- Minimized Filters/Options -->
        <select name="block_bots">
            <option value="true">Block Bot: ON</option>
            <option value="false">Block Bot: OFF</option>
        </select>

        <select name="block_vpn">
            </td>
            <td class="mono" style="font-size: 1.1rem;">{{ link.visits|length }}</td>
            <td class="mono" style="font-size: 0.9rem; color: var(--text-sec);">
                {{ link.created_at.strftime('%Y-%m-%d') }}
                <div style="font-size:0.8rem;">
                    <!-- Freed up space (User Request) -->
                </div>
            </td>
            <td style="text-align: right; padding-right: 24px;">
                <div class="flex-row" style="justify-content: flex-end;">
                    <button class="btn-outline btn-sm" /" ~ link.slug) }}')"><i class="fas fa-copy"></i></button>
                    <a href="/dashboard/qr_view/{{ link.slug }}" class="btn-outline btn-sm"><i
                            class="fas fa-qrcode"></i></a>
                    <a href="/dashboard/stats/{{ link.slug }}" class="btn-outline btn-sm"><i
                            class="fas fa-chart-line"></i></a>
                    <a href="/dashboard/edit/{{ link.slug }}" class="btn-outline btn-sm"><i class="fas fa-edit"></i></a>

                    <form method="POST" action="/dashboard/delete/{{ link.id }}" onsubmit="return confirm('Delete?');"
                        style="display:inline;">


                        {{ csrf_token() }}
                        <button type="submit" class="btn-sm btn-danger"><i class="fas fa-trash"></i></button>
                    </form>
                </div>
            </td>
            </tr>
            {% endfor %}
            </tbody>
            </table>
</div>

<script>
    function copyLink(url) {
        navigator.clipboard.writeText(url).then(() => {
            alert("Copied: " + url);
        });
    }
</script>

{% endblock %}