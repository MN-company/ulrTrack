{% extends "base.html" %}

{% block breadcrumb %}Command Center{% endblock %}

{% block content %}
<div class="dashboard-grid">
    <!-- Stat Card: Total Visits -->
    <div class="card glass">
        <div class="card-header">
            <span class="card-title">Total Intercepts</span>
            <i class="fa-solid fa-satellite-dish text-accent"></i>
        </div>
        <div class="stat-value">{{ visits|length }}</div>
        <div class="stat-trend trend-up">
            <i class="fa-solid fa-arrow-trend-up"></i> Live Tracking
        </div>
    </div>

    <!-- Stat Card: Leads -->
    <div class="card glass">
        <div class="card-header">
            <span class="card-title">Identified Targets</span>
            <i class="fa-solid fa-users-viewfinder text-accent" style="color: var(--accent-purple)"></i>
        </div>
        <div class="stat-value">{{ leads|length }}</div>
        <div class="stat-trend">
            <span class="text-muted">In Database</span>
        </div>
    </div>

    <!-- Stat Card: Active Links -->
    <div class="card glass">
        <div class="card-header">
            <span class="card-title">Active Campaigns</span>
            <i class="fa-solid fa-link text-accent" style="color: var(--accent-success)"></i>
        </div>
        <div class="stat-value">{{ links|length }}</div>
        <div class="stat-trend trend-up">
            <a href="{{ url_for('dashboard.dashboard_links.links') }}" style="font-size: 0.8rem">Manage Links &rarr;</a>
        </div>
    </div>
</div>

<div class="dashboard-grid" style="grid-template-columns: 2fr 1fr;">
    <!-- Recent Activity Feed -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title"><i class="fa-solid fa-tower-broadcast"></i> Live Feed (Last 10)</h3>
            <a href="{{ url_for('dashboard.dashboard_stats.global_timeline') }}" class="btn btn-ghost"
                style="font-size: 0.8rem">View All</a>
        </div>

        <table class="data-table">
            <thead>
                <tr>
                    <th>Time</th>
                    <th>Target (IP/Email)</th>
                    <th>Campaign</th>
                    <th>Location</th>
                </tr>
            </thead>
            <tbody>
                {% for v in visits[:10] %}
                <tr>
                    <td class="text-mono" style="font-size: 0.8rem">{{ v.timestamp.strftime('%H:%M:%S') }}</td>
                    <td>
                        {% if v.email %}
                        <span class="text-accent">{{ v.email }}</span>
                        {% else %}
                        <span class="text-mono">{{ v.ip_address }}</span>
                        {% endif %}
                    </td>
                    <td><span class="badge badge-blue">{{ v.link.slug }}</span></td>
                    <td>
                        {% if v.country %}
                        <img src="https://flagcdn.com/16x12/{{ v.country|lower }}.png" alt="{{ v.country }}"> {{ v.city
                        }}
                        {% else %}
                        <span class="text-muted">Unknown</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Quick Actions -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Quick Actions</h3>
        </div>

        <div style="display: flex; flex-direction: column; gap: 1rem;">
            <a href="{{ url_for('dashboard.dashboard_links.create_full') }}" class="btn btn-primary w-full"
                style="justify-content: center;">
                <i class="fa-solid fa-plus"></i> New Campaign
            </a>

            <div style="background: rgba(0,0,0,0.2); padding: 1rem; border-radius: 8px; margin-top: 1rem;">
                <h4 style="font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--text-secondary)">System Status</h4>
                <div class="flex-between" style="font-size: 0.85rem; margin-bottom: 0.25rem;">
                    <span>Worker</span>
                    <span class="text-accent"><i class="fa-solid fa-circle-check"></i> Active</span>
                </div>
                <div class="flex-between" style="font-size: 0.85rem;">
                    <span>AI Engine</span>
                    <span class="text-accent" style="color: var(--accent-purple)"><i class="fa-solid fa-bolt"></i>
                        Gemini 2.0</span>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Dashboard Loaded successfully -->
{% endblock %}