{% extends "base.html" %}

{% block content %}
<div class="card" style="max-width: 600px; margin: 0 auto;">
    <h2><i class="fas fa-cog"></i> System Settings</h2>
    <p style="color: var(--text-sec); font-size: 0.9rem; margin-bottom: 20px;">
        Directly modify the server environment. <span class="text-accent">Requires restart to fully apply.</span>
    </p>

    <div style="margin-bottom: 30px;">
        <a href="/dashboard/security" class="btn">
            <i class="fas fa-shield-alt"></i> Manage 2FA & Passkeys
        </a>
    </div>

    <form method="POST">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <div class="form-group">
            <label>API Key (Admin Password)</label>
            <div style="display: flex; gap: 10px;">
                <input type="password" name="api_key" id="apiKeyField" value="{{ api_key }}" required
                    style="flex-grow: 1;">
                <button type="button" class="btn-outline" onclick="toggleApiKey()" style="width: 50px;"><i
                        class="fas fa-eye" id="eyeIcon"></i></button>
            </div>
            <script>
                function toggleApiKey() {
                    var x = document.getElementById("apiKeyField");
                    var icon = document.getElementById("eyeIcon");
                    if (x.type === "password") {
                        x.type = "text";
                        icon.classList.remove("fa-eye");
                        icon.classList.add("fa-eye-slash");
                    } else {
                        x.type = "password";
                        icon.classList.remove("fa-eye-slash");
                        icon.classList.add("fa-eye");
                    }
                }
            </script>
        </div>

        <div class="form-group" style="margin-top: 15px;">
            <label>Server URL (Base Address)</label>
            <input type="url" name="server_url" value="{{ server_url }}" required>
            <small style="color:var(--text-sec);">Used for generating short links (e.g. http://mysite.com)</small>
        </div>

        <div class="form-group" style="margin-top: 15px;">
            <label>OSINT Command (Holehe)</label>
            <input type="text" name="holehe_cmd" value="{{ holehe_cmd }}" placeholder="holehe">
            <small style="color:var(--text-sec);">Custom command or path if 'holehe' is not in PATH.</small>
        </div>

        <hr style="border:0; border-top:1px solid rgba(255,255,255,0.1); margin:20px 0;">

        <h4><i class="fas fa-robot"></i> AI Configuration</h4>

        <div class="form-group" style="margin-top: 15px;">
            <label>Gemini Model</label>
            <div style="position:relative;">
                <i class="fas fa-microchip"
                    style="position:absolute; left:12px; top:50%; transform:translateY(-50%); color:var(--text-sec);"></i>
                <select name="gemini_model" style="padding-left: 36px; appearance:none;">
                    <option value="gemini-3-flash-preview" {% if gemini_model=='gemini-3-flash-preview' %}selected{%
                        endif %}>
                        âš¡ Gemini 3 Flash Preview (User Requested)
                    </option>
                    <option value="gemini-2.5-pro" {% if gemini_model=='gemini-2.5-pro' %}selected{% endif %}>
                        ðŸ§  Gemini 2.5 Pro (User Requested)
                    </option>
                    <option value="gemini-flash-latest" {% if gemini_model=='gemini-flash-latest' %}selected{% endif %}>
                        ðŸš€ Gemini Flash Latest
                    </option>
                    <option value="gemini-3-pro-preview" {% if gemini_model=='gemini-3-pro-preview' %}selected{% endif
                        %}>
                        ðŸ“Š Gemini 3 Pro Preview
                    </option>
                    <option value="gemini-1.5-pro" {% if gemini_model=='gemini-1.5-pro' %}selected{% endif %}>
                        ðŸŸ¢ Gemini 1.5 Pro (Stable Fallback)
                    </option>
                </select>
            </div>
        </div>

        <div class="form-group" style="margin-top: 20px;">
            <label style="display:flex; justify-content:space-between;">
                <span>System Prompt (Persona)</span>
                <span style="font-size:0.7rem; color:var(--text-sec);"><i class="fas fa-code"></i> Markdown
                    Supported</span>
            </label>
            <textarea name="ai_prompt" rows="8"
                style="font-family: 'JetBrains Mono', 'Fira Code', monospace; font-size: 0.85rem; line-height: 1.5; background: #0d0d0d; color: #00ff9d; border: 1px solid #333;"
                placeholder="You are an expert Cyber Intelligence Analyst...">{{ ai_prompt }}</textarea>
            <div style="font-size:0.75rem; color:var(--text-sec); margin-top:5px; display:flex; gap:10px;">
                <span><i class="fas fa-info-circle"></i> Define how the AI interprets user agents and headers.</span>
            </div>
        </div>

        <div
            style="margin-top: 30px; border-top: 1px solid var(--border-subtle); padding-top: 20px; text-align: right; display: flex; justify-content: flex-end; gap: 10px;">
            <a href="/dashboard" class="btn-outline">Cancel</a>
            <button type="submit" class="btn btn-primary">SAVE CONFIGURATION</button>
        </div>
    </form>
</div>
{% endblock %}